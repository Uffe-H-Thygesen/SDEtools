<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fisheries Management - a Numerical Optimal Control Problem • SDEtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fisheries Management - a Numerical Optimal Control Problem">
<meta property="og:description" content="SDEtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SDEtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SDEtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BrownianMotion.html">Brownian Motion</a>
    </li>
    <li>
      <a href="../articles/FisheriesManagement.html">Fisheries Management - a Numerical Optimal Control Problem</a>
    </li>
    <li>
      <a href="../articles/HMM-filtering-of-scalar-SDEs.html">HMM filtering of scalar SDEs</a>
    </li>
    <li>
      <a href="../articles/NoisyOscillator.html">The noisy harmonic oscillator</a>
    </li>
    <li>
      <a href="../articles/NumericalKolmogorov.html">Numerical Analysis of the Kolmogorov Equations</a>
    </li>
    <li>
      <a href="../articles/vanderPol.html">A 2D example: The van der Pol oscillator</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Uffe-H-Thygesen/SDEtools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fisheries Management - a Numerical Optimal
Control Problem</h1>
                        <h4 data-toc-skip class="author">Uffe Høgsbro
Thygesen</h4>
            
            <h4 data-toc-skip class="date">2023-02-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Uffe-H-Thygesen/SDEtools/blob/HEAD/vignettes/FisheriesManagement.Rmd" class="external-link"><code>vignettes/FisheriesManagement.Rmd</code></a></small>
      <div class="hidden name"><code>FisheriesManagement.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="fisheries-as-optimal-control">Fisheries as optimal control<a class="anchor" aria-label="anchor" href="#fisheries-as-optimal-control"></a>
</h2>
<p>Following the textbook, we consider the problem of optimal harvest of
a fish stock. Our objective in this vignette is to demonstrate the
numerical solution of the optimal control problem. The controlled system
dynamics are</p>
<p><span class="math display">\[
dX_t = [ X_t(1-X_t) - U_t] ~dt + \sigma X_t ~dB_t
\]</span></p>
<p>Here, <span class="math inline">\(X_t\)</span> is the biomass, and
<span class="math inline">\(B_t\)</span> is standard Brownian motion.
The term <span class="math inline">\(X_t(1-X_t)\)</span> is the growth
without fishing, i.e. logistic growth; we have made time and abundance
dimensionless. <span class="math inline">\(U_t\)</span> is the harvest
rate. We aim to maximize <span class="math inline">\(\sqrt{U_t}\)</span>
in steady state, which leads to the Hamilton-Jacobi-Bellman equation</p>
<p><span class="math display">\[
\sup_{u\geq 0} \left[ \dot V + x(1-x) V' - uV' + \frac 12
\sigma^2 x^2 V'' + \sqrt u \right] = 0 .
\]</span></p>
<p>The optimal control is found as a stationary point: <span class="math inline">\(u= 1/4/(V')^2\)</span>.</p>
<p>The analytical solution to this problem is <span class="math display">\[
  V(x,t) = \frac 12 \log x -\gamma t
\]</span> where <span class="math inline">\(\gamma = \frac 12
(1-\sigma^2 /2)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="numerical-analysis-of-the-steady-state-problem">Numerical analysis of the steady-state problem<a class="anchor" aria-label="anchor" href="#numerical-analysis-of-the-steady-state-problem"></a>
</h2>
<p>We aim to verify the analytical solution numerically. We first set up
the model, writing it in advection-diffusion form. We use <span class="math inline">\(D=g^2/2\)</span> as the diffusivity and <span class="math inline">\(v=f-D'\)</span> as the advective field.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Uffe-H-Thygesen/SDEtools" class="external-link">SDEtools</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: SDEtools</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">sigma</span><span class="op">*</span><span class="va">x</span></span>
<span></span>
<span><span class="va">dg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">sigma</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu">g</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">dD</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">g</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu">dg</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu">dD</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>The following function gives the optimal control as a function of
<span class="math inline">\(x\)</span> and <span class="math inline">\(V'(x)\)</span>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">Vp</span><span class="op">)</span> <span class="fl">0.25</span><span class="op">/</span><span class="va">Vp</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<p>We now discretize the problem. We use a grid which is more dense near
the origin.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xmax</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Xmax</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">101</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>    <span class="co"># Interfaces between grid cells</span></span>
<span><span class="va">xc</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xi</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">xi</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>     <span class="co"># Center of grid cells</span></span></code></pre></div>
<p>We first define the generator without fishing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">G0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fvade.html">fvade</a></span><span class="op">(</span><span class="va">v</span>,<span class="va">D</span>,<span class="va">xi</span>,<span class="st">'r'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Matrix</span></span></code></pre>
<p>and next the generator corresponding to fishing:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">G1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fvade.html">fvade</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fl">0</span>,<span class="va">xi</span>,<span class="st">'r'</span><span class="op">)</span></span></code></pre></div>
<p>Note that this discretizes the operator <span class="math inline">\(V\mapsto -V'\)</span>.</p>
<p>We are now almost ready to solve the steady-state problem using
policy iteration. But first, to make the nummerics more robust, we make
two changes: First, at the left cell, we assume that we cannot fish.
This avoids the option of driving the fish to extinction and then fish
like crazy on fish that aren’t there. Next, we assume that there is a
bound on the harvest, even if <span class="math inline">\(V'(x)=0\)</span>. We do that by replacing
<span class="math inline">\(V'(x)\)</span> with <span class="math inline">\(\max(epsilon,V'(x))\)</span> where <span class="math inline">\(\epsilon\)</span> is a “small” number.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-1</span></span>
<span><span class="va">uopt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">G1V</span><span class="op">)</span> </span>
<span>  <span class="op">{</span></span>
<span>     <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu">mu</span><span class="op">(</span><span class="va">xc</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">epsilon</span>,<span class="op">-</span><span class="va">G1V</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">u</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>Finally, we need the pay-off:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span></code></pre></div>
<p>We can now solve the steady-state problem using policy iteration:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PolicyIterationSingular.html">PolicyIterationSingular</a></span><span class="op">(</span><span class="va">G0</span>,<span class="va">G1</span>,<span class="va">k</span>,<span class="va">uopt</span>,do.minimize<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We plot the policy and the value function compared with the
analytical results:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">sol</span><span class="op">$</span><span class="va">V</span>,type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"x"</span>,ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">V</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xc</span>,<span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">[</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">sol</span><span class="op">$</span><span class="va">V</span><span class="op">[</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Note the excellent agreement. Similarly, for the control:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">sol</span><span class="op">$</span><span class="va">u</span>,type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"x"</span>,ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">mu</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">xc</span><span class="op">^</span><span class="fl">2</span>,lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Note that there is some discrepancy at the upper boundary, where the
discretized problem fishes really hard to avoid the risk of hitting the
boundary, which would be wasteful.</p>
<p>We finally plot the stationary distribution of the state under the
time-invariant control.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">sol</span><span class="op">$</span><span class="va">pi</span>,type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"x"</span>,ylab<span class="op">=</span><span class="st">"p.d.f."</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="the-time-varying-problem">The time-varying problem<a class="anchor" aria-label="anchor" href="#the-time-varying-problem"></a>
</h2>
<p>Here, we demonstrate how to solve the time-varying HJB equation by
time marching. There is no particular reason to do this for this
problem, but one could imagine extensions where system parameters vary
with time etc. Therefore we include this.</p>
<p>The time-varying problem runs in a backward iteration. We set up
arrays for the value function and for the optimal harvest. Here, the row
index corresponds to the state, while the column index corresponds to
the time. We fill in the last column of <span class="math inline">\(V\)</span> with the terminal condition, which we
take to be all 0.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">T</span>,<span class="va">dt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p>The backward iteration works in two steps: First, we use <span class="math inline">\(V(\cdot,t)\)</span> to identify the optimal
control <span class="math inline">\(\mu(x)\)</span>. This is specific to
the current time step but our notation suppresses this. Next, we assume
that this control strategy is applied during the preceding time
interval. To this end, we write the equation in the value function as
<span class="math display">\[
\dot V + G_{cl}V + k = 0
\]</span> where <span class="math inline">\(G_{cl}\)</span> is the
closed loop generator, and <span class="math inline">\(k\)</span> is the
running reward with the current control strategy. For our example, <span class="math inline">\(G_{cl}\)</span> discretizes the operator <span class="math display">\[
x(1-x)V' - \mu(x)V' + \frac 12 \sigma^2 V''
\]</span> where <span class="math inline">\(\mu(x)\)</span> is fixed.
Similarly, <span class="math inline">\(k\)</span> is a vector that
evaluates <span class="math inline">\(\sqrt{\mu(x)}\)</span>.</p>
<p>To solve this equation exactly, i.e., without time discretization
error, we write it as a coupled system <span class="math inline">\(\dot
k = 0\)</span> and solve the combined system. Let <span class="math inline">\(Z = (V,k)\)</span>, then <span class="math display">\[
- \dot Z = \left[ \begin{array}{cc} G_{cl} &amp; I \\ 0 &amp; 0
\end{array} \right] Z
\]</span> We solve this system using the matrix exponential. The top
half elements is the solution at the previous time step.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OO</span> <span class="op">&lt;-</span> <span class="fu">sparseMatrix</span><span class="op">(</span>i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,j<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,x<span class="op">=</span><span class="fl">0</span>,dims<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span>,<span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co">## Find optimal control strategy</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu">uopt</span><span class="op">(</span><span class="va">G1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">U</span><span class="op">[</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">u</span></span>
<span>  </span>
<span>  <span class="co">## Construct the "closed loop" system that results from applying this control strategy</span></span>
<span>  <span class="va">Gcl</span> <span class="op">&lt;-</span> <span class="va">G0</span> <span class="op">+</span> <span class="fu">Diagonal</span><span class="op">(</span>x<span class="op">=</span><span class="va">u</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">G1</span></span>
<span>  </span>
<span>  <span class="va">GG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Gcl</span>,<span class="fu">Diagonal</span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span>,x<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,<span class="va">OO</span><span class="op">)</span></span>
<span>  <span class="va">Vkterm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,<span class="fu">k</span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Vksol</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="op">(</span><span class="va">GG</span><span class="op">*</span><span class="va">dt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Vkterm</span></span>
<span>  <span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Vksol</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The following plot shows the value function at the various points in
time. Notice that it quite quickly seems to enter a steady state where
the value function is just shifted the same amount from each time step
to the previous. This reflects that the problem effectively is in steady
state here: The control horizon is long compared to the mixing time of
the controlled process. The shift corresponds to <span class="math inline">\(\gamma\)</span>, the pay-off rate in steady state.
The red line is the analytical result from the steady-state problem.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">V</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xc</span>,<span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">[</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="va">V</span><span class="op">[</span><span class="fl">50</span>,<span class="fl">1</span><span class="op">]</span>,lty<span class="op">=</span><span class="st">"dashed"</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>The following contour plot shows the optimal control as a function of
time and state. Note that we fish hard when we are close to the terminal
time, since this problem does not include a terminal reward for leaving
fish in the system at the end of time.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">tv</span>,<span class="va">xc</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">0.25</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,xlab<span class="op">=</span><span class="st">"t"</span>,ylab<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="implicit-euler-time-stepping">Implicit Euler time stepping<a class="anchor" aria-label="anchor" href="#implicit-euler-time-stepping"></a>
</h2>
<p>The matrix exponential in the previous is expensive for large
problems. So therefore we give here a variant of the code which uses
implicit Euler to time step the HJB equation rather than the matrix
exponential. The equation is time discretized as</p>
<p><span class="math display">\[
\frac 1h (V_t - V_{t-h} ) + G_{cl} V_{t-h} + k = 0
\]</span></p>
<p>i.e.,</p>
<p><span class="math display">\[
  V_{t-h} = (I - G_{cl} h)^{-1} (V_t + hk)
\]</span></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co">## Find optimal control strategy</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu">uopt</span><span class="op">(</span><span class="va">G1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">U</span><span class="op">[</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">u</span></span>
<span>  </span>
<span>  <span class="co">## Construct the "closed loop" system that results from applying this control strategy</span></span>
<span>  <span class="va">Gcl</span> <span class="op">&lt;-</span> <span class="va">G0</span> <span class="op">+</span> <span class="fu">Diagonal</span><span class="op">(</span>x<span class="op">=</span><span class="va">u</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">G1</span></span>
<span>  </span>
<span>  <span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu">Diagonal</span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span>,x<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">Gcl</span><span class="op">*</span><span class="va">dt</span>,<span class="va">V</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">dt</span><span class="op">*</span><span class="fu">k</span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We repeat the two previous plots. Note that the transients are
slightly different due to the coarse time step, but that the steady
state is the same.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">xc</span>,<span class="va">V</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xc</span>,<span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xc</span><span class="op">[</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="va">V</span><span class="op">[</span><span class="fl">50</span>,<span class="fl">1</span><span class="op">]</span>,lty<span class="op">=</span><span class="st">"dashed"</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">tv</span>,<span class="va">xc</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">0.25</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,xlab<span class="op">=</span><span class="st">"t"</span>,ylab<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="FisheriesManagement_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Uffe Hogsbro Thygesen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
